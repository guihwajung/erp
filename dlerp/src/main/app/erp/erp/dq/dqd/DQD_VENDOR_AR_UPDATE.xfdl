<?xml version="1.0" encoding="utf-8"?>
<FDL version="2.0">
  <Form id="form" width="820" height="270" titletext="New Form" onload="form_onload">
    <Layouts>
      <Layout>
        <Div id="divData" taborder="0" left="0" top="0" bottom="0" right="0" cssclass="div_DATA_Bg" text="">
          <Layouts>
            <Layout>
              <Static id="staBgIN_TELF00" taborder="38" left="507" top="93" width="300" height="30" cssclass="sta_WF_tablebg"/>
              <Static id="staBgIN_SORTL00" taborder="37" left="109" top="151" width="300" height="30" cssclass="sta_WF_tablebg"/>
              <Static id="staTITLE" taborder="14" text="매출(SAP) 거래처코드 변경" left="0" top="0" width="100.00%" height="30" cssclass="sta_TITLE_Bg" textAlign="left"/>
              <Static id="staIN_STCD2" taborder="15" text="고객 계정 그룹" left="0" top="staTITLE:5" width="110" height="30" textAlign="right" onclick="divData_staIN_STCD2_onclick" cssclass="sta_WF_tablelabelE"/>
              <Static id="staIN_KTOKK" taborder="16" text="사업자등록번호" left="0" top="staIN_STCD2:-1" width="110" height="30" textAlign="right" cssclass="sta_WF_tablelabelE"/>
              <Static id="staIN_NAME1" taborder="17" text="우편번호" left="0" top="staIN_KTOKK:-1" width="110" height="30" textAlign="right" cssclass="sta_WF_tablelabelE"/>
              <Static id="staIN_SORTL" taborder="18" text="대표자이름" left="0" top="staIN_NAME1:-1" width="110" height="30" textAlign="right" cssclass="sta_WF_tablelabelE"/>
              <Static id="staIN_PSTLZ" taborder="19" text="업 종" left="0" top="staIN_SORTL:-1" width="110" height="30" textAlign="right" cssclass="sta_WF_tablelabelE"/>
              <Static id="staIN_ORT01" taborder="20" text="지급 조건" left="0" top="staIN_PSTLZ:-1" width="110" height="30" cssclass="sta_WF_tablelabel" textAlign="right" textDecoration="none"/>
              <Static id="staBgIN_STCD2" taborder="21" left="staIN_STCD2:-1" top="staTITLE:5" width="300" height="30" cssclass="sta_WF_tablebg"/>
              <Static id="staBgIN_KTOKK" taborder="22" left="staIN_KTOKK:-1" top="staBgIN_STCD2:-1" width="300" height="30" cssclass="sta_WF_tablebg"/>
              <Static id="staBgIN_NAME1" taborder="23" left="staIN_NAME1:-1" top="staBgIN_KTOKK:-1" width="300" height="30" cssclass="sta_WF_tablebg"/>
              <Static id="staBgIN_SORTL" taborder="24" left="staIN_SORTL:-1" top="staBgIN_NAME1:-1" width="300" height="30" cssclass="sta_WF_tablebg"/>
              <Static id="staBgIN_ORT01" taborder="25" left="staIN_ORT01:-1" top="180" width="300" height="30" cssclass="sta_WF_tablebg"/>
              <Static id="staIN_TELF1" taborder="26" text="고객명" left="staBgIN_STCD2:-1" top="staTITLE:5" width="100" height="30" textAlign="right" cssclass="sta_WF_tablelabelE"/>
              <Static id="staIN_TELF2" taborder="27" text="지역" left="staBgIN_KTOKK:-1" top="staIN_TELF1:-1" width="100" height="30" textAlign="right" cssclass="sta_WF_tablelabelE"/>
              <Static id="staIN_LFURL" taborder="28" text="상세주소" left="staBgIN_NAME1:-1" top="staIN_TELF2:-1" width="100" height="30" textAlign="right" cssclass="sta_WF_tablelabelE"/>
              <Static id="staIN_J_1KFREPRE" taborder="29" text="대표자주민번호" left="staBgIN_SORTL:-1" top="staIN_LFURL:-1" width="100" height="30" cssclass="sta_WF_tablelabel" textAlign="right" textDecoration="none"/>
              <Static id="staIN_STCD1" taborder="30" text="업 태" left="408" top="staIN_J_1KFREPRE:-1" width="100" height="30" textAlign="right" cssclass="sta_WF_tablelabelE"/>
              <Static id="staIN_J_1KFTBUS" taborder="31" text="인도조건" left="staBgIN_ORT01:-1" top="staIN_STCD1:-1" width="100" height="30" cssclass="sta_WF_tablelabel" textAlign="right" textDecoration="none"/>
              <Static id="staBgIN_TELF1" taborder="32" left="staIN_TELF1:-1" top="staTITLE:5" width="300" height="30" cssclass="sta_WF_tablebg"/>
              <Static id="staBgIN_TELF2" taborder="33" left="staIN_TELF2:-1" top="staBgIN_TELF1:-1" width="300" height="30" cssclass="sta_WF_tablebg"/>
              <Static id="staBgIN_J_1KFREPRE" taborder="34" left="staIN_J_1KFREPRE:-1" top="122" width="300" height="30" cssclass="sta_WF_tablebg"/>
              <Static id="staBgIN_STCD1" taborder="35" left="staIN_STCD1:-1" top="staBgIN_J_1KFREPRE:-1" width="300" height="30" cssclass="sta_WF_tablebg"/>
              <Static id="staBgIN_J_1KFTBUS" taborder="36" left="staIN_J_1KFTBUS:-1" top="staBgIN_STCD1:-1" width="300" height="30" cssclass="sta_WF_tablebg"/>
              <Div id="ccfZTERM" CDTextWidth="50" taborder="10" left="114" top="185" width="290" height="20" url="cmm::cmmCodeFind.xfdl" enable="true"/>
              <Edit id="ctxtNAME1" taborder="1" left="staIN_TELF1:4" top="staTITLE:10" width="290" height="20" value=""/>
              <Edit id="ctxtSUPPL2" taborder="5" left="staIN_TELF2:4" top="ctxtNAME1:38" width="290" height="20" value=""/>
              <Edit id="ctxtJ_1KFREPRE" taborder="6" left="staIN_J_1KFREPRE:-394" top="127" width="290" height="20" value=""/>
              <Edit id="ctxtJ_1KFTBUS" taborder="9" left="staIN_STCD1:4" top="ctxtJ_1KFREPRE:9" width="290" height="20" value="" enable="true"/>
              <Button id="btnOk" taborder="12" text="확인" left="38.66%" top="228" width="60" height="20" onclick="divData_btnOk_onclick"/>
              <Button id="btnCancel" taborder="13" text="취소" left="49.27%" top="228" width="60" height="20" onclick="divData_btnCancel_onclick"/>
              <Div id="ccfKTOKD" CDTextWidth="50" taborder="0" left="114" top="40" width="290" height="20" url="cmm::cmmCodeFind.xfdl" enable="true"/>
              <Div id="ccfREGIO" CDTextWidth="50" taborder="3" left="512" top="69" width="290" height="20" url="cmm::cmmCodeFind.xfdl"/>
              <Edit id="ctxtSTCD1" taborder="7" left="512" top="127" width="290" height="20" value=""/>
              <Edit id="ctxtJ_1KFTIND" taborder="8" left="114" top="156" width="290" height="20" value="" enable="true"/>
              <Div id="ccfINCO1" CDTextWidth="50" taborder="11" left="512" top="185" width="290" height="20" url="cmm::cmmCodeFind.xfdl" enable="true"/>
              <Edit id="ctxtSTCD2" taborder="2" left="114" top="69" width="290" height="20" value="" enable="true"/>
              <Div id="ccfPSTLZ" CDTextWidth="50" taborder="4" left="114" top="98" width="290" height="20" url="cmm::cmmCodeFind.xfdl"/>
            </Layout>
          </Layouts>
        </Div>
      </Layout>
    </Layouts>
    <Script type="xscript5.1"><![CDATA[this.objApp = this.gfnGetApplication();
//this.beAfGun = "";	// sap처리전에는 값이 [be]가 셋팅되고 처리후에는 [af]가 셋팅된다(이력저장 구분용)

this.form_onload = function(obj:nexacro.Form,e:nexacro.LoadEventInfo)
{
	// -- 필수 -------------------//
	this.gfnFormOnLoad(this);	
	this.gfnFormInfo(this);		
	// ---------------------------//
	
	this.fnSetButton();
	this.fnSetExtendButton();
	this.fnSetVariable();
	this.fnSetEvent();
	this.fnSetParameter();
	
	// 이전 화면에서 데이터 받기.
	this.dsSearch.setColumn(0, "KUNNR", this.getOwnerFrame().KUNNR);
	
	this.fnSapSelect(this.dsSearch.getColumn(0, "KUNNR"));	//거래처번호

};

/************************************************************************
 * 버튼 설정 : 화면(Tab) 전환시 마다 호출
 * 서브버튼 사용 및 공통버튼 강제 제어시 여기서 처리
 ************************************************************************/
this.fnSetButton = function() {
	this.FormBtns.Select.set_enable(false);
}

/************************************************************************
 * 확장 버튼 : 화면별 버튼 설정 ID, function 연결 (화면버튼관리)
 ************************************************************************/
this.fnSetExtendButton = function() {

};

/************************************************************************
 * 변수 선언
 ************************************************************************/
this.fnSetVariable = function() {	
	this.ccfKTOKD = this.divData.form.ccfKTOKD;
	this.ccfREGIO = this.divData.form.ccfREGIO;	
	this.ccfINCO1 = this.divData.form.ccfINCO1;
	this.ccfZTERM = this.divData.form.ccfZTERM;
	this.ccfPSTLZ = this.divData.form.ccfPSTLZ;
};

/************************************************************************
 * 이벤트 설정
 ************************************************************************/
this.fnSetEvent = function() {
	this.ccfKTOKD.CodeFindName = "CF_CODE_DQ_S09";
	this.ccfREGIO.CodeFindName = "CF_CODE_DQ_S05";
	this.ccfINCO1.CodeFindName = "CF_CODE_DH_S14";
	this.ccfZTERM.CodeFindName = "CF_CODE_DH_S06";
	this.ccfPSTLZ.CodeFindName = "DZX_CFZIP_STREET";
};

/************************************************************************
 * 파라미터 설정
 ************************************************************************/
this.fnSetParameter = function() {
	
	this.dsSelectSap = new Dataset();
	this.dsSelectSap.addColumn("KTOKD", "string");
	this.dsSelectSap.addColumn("NAME1", "string");
	this.dsSelectSap.addColumn("SUPPL1", "string");
	this.dsSelectSap.addColumn("SUPPL2", "string");
	this.dsSelectSap.addColumn("LAND1", "string");
	this.dsSelectSap.addColumn("REGIO", "string");
	this.dsSelectSap.addColumn("STCD1", "string");
	this.dsSelectSap.addColumn("STCD2", "string");
	this.dsSelectSap.addColumn("J_1KFREPRE", "string");	
	this.dsSelectSap.addColumn("J_1KFTBUS", "string");
	this.dsSelectSap.addColumn("J_1KFTIND", "string");
	this.dsSelectSap.addColumn("ZSALES", "string");
	this.dsSelectSap.addColumn("VKBUR", "string");
	this.dsSelectSap.addColumn("INCO1", "string");
	this.dsSelectSap.addColumn("ZTERM", "string");
	this.dsSelectSap.addColumn("TAXKD", "string");			
	this.dsSelectSap.addColumn("LIFNR", "string");	
	this.dsSelectSap.addColumn("ZSUBRC", "string");	
	this.dsSelectSap.addColumn("TXT", "string");	
	this.dsSelectSap.addColumn("PSTLZ", "string");	
	
	this.dsSap = new Dataset();
	this.dsSap.addColumn("IV_KUNNR", "string");
	
	this.dsExec = new Dataset();
	this.dsExec.addColumn("PARAM", "string");
	
	this.dsUpdate = new Dataset();
	this.dsUpdate.addColumn("KUNNR", "string");
	
	//this.dsSelectSap1 = new Dataset();
	//this.dsSelectSap1.addColumn("I_KUNNR", "string");
}

/************************************************************************
 * 컨트롤 이벤트
 ************************************************************************/
  /*
  *	조회 버튼
  */
this.fnSelect = function() {
	
}

this.fnSapSelect = function(plifnr) {
	this._dsProcSap.clearData();
	var nrow = this._dsProcSap.addRow();
	this._dsProcSap.setColumn(nrow, "TARGET", "select");
	this._dsProcSap.setColumn(nrow, "SP", "ZERP_SD_0001");
	
	this.dsSelectSap1 = new Dataset();
	this.dsSelectSap1.addColumn("I_KUNNR", "string");	
	
	nrow = this.dsSelectSap1.addRow();
	// IN 파라미터 셋팅
	this.dsSelectSap1.setColumn(nrow, "I_KUNNR", plifnr);	// 거래처코드
	//this.dsSelectSap1.setColumn(nrow, "I_KUNNR", "0000305720");	// 거래처코드	

	// SAP 호출
	var strSvcId    = "sap_select";
	var strSvcType  = "sap";
	var inProc		= "_dsProcSap";
	var inData      = "select=dsSelectSap1";
	var outData     = "dsExport=export dsOT_ITAB=OT_ITAB dsOT_ADDR=OT_ADDR";
	var strArg      = "gubun=update";
	var callBackFnc = "fnCallback";	
	
	this.gfnTransaction( strSvcId , 	// transaction을 구분하기 위한 svc id값
						strSvcType , 	// transaction을 요청할 구분
						inProc,			// Procedure 정보 Dataset 이름
						inData , 		// 입력값으로 보낼 dataset id , a=b형태로 실제이름과 입력이름을 매칭
						outData , 		// 처리결과값으로 받을 dataset id, a=b형태로 실제이름과 입력이름을 매칭
						strArg, 		// 입력값으로 보낼 arguments, strFormData="20120607"
						callBackFnc); // 통신방법 정의 [생략가능]
}


this.fnSapUpdate = function()
{
	this.dsList.clearData();
	
	var nrow = this.dsList.addRow();
	
	this.dsList.setColumn(nrow, "KTOKD", this.dsOT_ITAB.getColumn(0, "KTOKD"));
	this.dsList.setColumn(nrow, "NAME1", this.dsOT_ITAB.getColumn(0, "NAME1"));
	this.dsList.setColumn(nrow, "STCD2", this.dsOT_ITAB.getColumn(0, "STCD2"));
	this.dsList.setColumn(nrow, "REGIO", this.dsOT_ITAB.getColumn(0, "REGIO"));
	this.dsList.setColumn(nrow, "PSTLZ", this.dsOT_ITAB.getColumn(0, "PSTLZ"));
	this.dsList.setColumn(nrow, "SUPPL2", this.dsOT_ADDR.getColumn(0, "STR_SUPPL2"));
	this.dsList.setColumn(nrow, "J_1KFREPRE", this.dsOT_ITAB.getColumn(0, "J_1KFREPRE"));
	this.dsList.setColumn(nrow, "STCD1", this.dsOT_ITAB.getColumn(0, "STCD1"));
	this.dsList.setColumn(nrow, "J_1KFTIND", this.dsOT_ITAB.getColumn(0, "J_1KFTIND"));
	this.dsList.setColumn(nrow, "J_1KFTBUS", this.dsOT_ITAB.getColumn(0, "J_1KFTBUS"));
	this.dsList.setColumn(nrow, "LIFNR", this.dsOT_ITAB.getColumn(0, "LIFNR"));
	
	this.divData.form.ccfPSTLZ.form.DSTextBox.set_value(this.dsOT_ADDR.getColumn(0, "STR_SUPPL1"));	
	
	this.divData.form.ccfKTOKD.form.fnCodeFindLoad();
	this.divData.form.ccfREGIO.form.fnCodeFindLoad();
}

this.fnUpdate = function()
{
	this.dsUpdate.clearData();
	
	var nrow = this.dsUpdate.addRow();
	this.dsUpdate.setColumn(0, "KUNNR", this.dsSearch.getColumn(0, "KUNNR"));

	if (this.dsUpdate.rowcount == 0) return;

	var strSvcId    = "update";
	var strSvcType  = "save";
	var inProc		= "_dsProc";
	var inData      = "update=dsUpdate";
	var outData     = "";
	var strArg      = "";
	var callBackFnc = "fnCallback";
	
	this.gfnTransaction( strSvcId , 	// transaction을 구분하기 위한 svc id값
						strSvcType , 	// transaction을 요청할 구분
						inProc,			// Procedure 정보 Dataset 이름
						inData , 		// 입력값으로 보낼 dataset id , a=b형태로 실제이름과 입력이름을 매칭
						outData , 		// 처리결과값으로 받을 dataset id, a=b형태로 실제이름과 입력이름을 매칭
						strArg, 			// 입력갑스로 보낼 arguments, strFormData="20120607"
						callBackFnc); // 통신방법 정의 [생략가능]
	
}
/************************************************************************
 * Validate
 ************************************************************************/

/************************************************************************
 * 콜백 이벤트
 ************************************************************************/
/*
 *	콜백 처리
 */
this.fnCallback = function(svcID, errorCode, errorMsg, strArg)
{
	if(svcID == "sap_select")
	{
		if(this.dsExport.rowcount > 0) {
			var json = this.gfnArgsToJson(strArg);
			strArg = json.gubun;
		
			if(strArg == "insert")
			{
				this.fnSapInsert();
			}
			else if(strArg == "update")
			{
				if(this.dsExport.getColumn(0, "O_RTNCD") == "S")
				{
					this.fnSapUpdate();
				}
				else
				{
					this.gfnAlert(this.dsExport.getColumn(0, "O_RTNMSG"));
				}
			}
		}
		else
		{
			this.gfnAlert("반환된 데이터가 없습니다.");
		}	
	}
	else if(svcID == "sap_update")
	{
		if(this.dsExport.rowcount > 0) {
			this.fnExec();
			/*
			if(this.dsExport.getColumn(0, "O_RTNCD") == "S")
			{				
				this.fnSapUpdateCallback = function() {
					// 전송 데이터 이력 저장
					this.beAfGun = "af";	// sap처리후 구분값 셋팅
					this.fnExec();
					//this.getParentContext().close(true);
				}
				this.gfnAlert("거래처수정 완료되었습니다.", "fnSapUpdateCallback");
			}
			else
			{				
				this.gfnAlert("입력값을 확인하세요.");
				//this.gfnAlert("입력값을 확인하세요.\n\n("+this.dsExport.getColumn(0, "O_RTNMSG")+")");
			}
			*/
		}
	}
	else if(svcID == "exec") {	// sap 보낸정보를 먼저 저장한 후에 처리한다
		if(errorCode == 0) {
			if(this.dsExport.getColumn(0, "O_RTNCD") == "S")
			{				
				this.fnUpdate();
// 				this.fnSapUpdateCallback = function() {
// 					// 전송 데이터 이력 저장
// 					//this.beAfGun = "af";	// sap처리후 구분값 셋팅
// 					//this.fnExec();
// 					this.getParentContext().close(true);
// 				}
// 				this.gfnAlert("거래처수정 완료되었습니다.", "fnSapUpdateCallback");
			}
			else
			{				
				this.gfnAlert("입력값을 확인하세요.");
				//this.gfnAlert("입력값을 확인하세요.\n\n("+this.dsExport.getColumn(0, "O_RTNMSG")+")");
			}
			/*
			if(this.beAfGun == "be"){
				this.fnSapVenderUpdate();
			}else{
				this.getParentContext().close(true);
			}
			*/
		}
		else
		{
			this.gfnAlert(errorMsg);
		}		
	}
	else if(svcID == "update")
	{
		if(errorCode == 0) {
			this.fnUpdate_callback = function() {

				this.getParentContext().close(true);
			}
			this.gfnAlert("거래처수정 완료되었습니다.", "fnUpdate_callback");
		}
		else
		{
			this.gfnAlert(errorMsg);
		}
	}
	
	/*
	if (errorCode == 0) {
		if (svcID == "sap") {
			if(this.dsList1.rowcount > 0) {trace(this.dsList1.saveXML());			
				if(this.dsList1.getColumn(0, "ZSUBRC") == "S")
				{
					this.fnSapSub();
				}
				else if(this.gfnIsNull(this.dsList1.getColumn(0, "TXT")))
				{
					this.gfnAlert("입력 정보를 확인해주세요.");
				}
				else
				{
					this.gfnAlert(this.dsList1.getColumn(0, "TXT"));
				}
			}
			else
			{
				this.gfnAlert("반환된 데이터가 없습니다.");
			}
			
		}	
		else if (svcID == "sap1") {trace(this.dsExport.saveXML());trace(this.dsOT_ITAB.saveXML());
			if(this.dsExport.rowcount > 0) {
				//if(this.dsExport.getColumn(0, "O_RTNCD").substr(0,1) == "S")
				if(this.dsExport.getColumn(0, "O_RTNCD") == "S")
				{
					this.fnInsert();
				}
				else
				{
					this.gfnAlert(this.dsExport.getColumn(0, "O_RTNMSG"));
				}
			}
			else
			{
				this.gfnAlert("반환된 데이터가 없습니다.");
			}		
		}
		else if(svcID == "insert") {
			if(errorCode == 0) {
				this.fnInsert_callback = function()
				{
					this.getParentContext().close(true);
				}	
				this.gfnAlert("거래처생성 완료되었습니다.", "fnInsert_callback");	
			}
			else
			{
				this.gfnAlert(errorMsg);
			}		
		}
	} else {
		this.gfnAlert(errorMsg);
	}
	*/
}

/************************************************************************
 * 코드파인드 이벤트
 ************************************************************************/

/************************************************************************
 * 그리드 이벤트
 ************************************************************************/
 
/************************************************************************
 * 기타 이벤트
 ************************************************************************/
// 확인 버튼 클릭
this.divData_btnOk_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	//this.beAfGun = "be";	// sap처리전 구분값 셋팅
	//this.fnExec();
	this.fnSapVenderUpdate();	
};

// sap 보낸정보를 저장한다
this.fnExec = function() {

	this.dsExec.clearData();
	
	this.dsExec.addRow();
	
	var paramVal =
	"<KTOKD:" + this.dsList.getColumn(0, "KTOKD") +
	"><NAME1:" + this.dsList.getColumn(0, "NAME1") +
	"><SUPPL1:" + this.dsList.getColumn(0, "SUPPL1") +
	"><SUPPL2:" + this.dsList.getColumn(0, "SUPPL2") +
	"><LAND1:" + "KR" +
	"><REGIO:" + this.dsList.getColumn(0, "REGIO") +
	"><STCD1:" + this.dsList.getColumn(0, "STCD1") +
	"><STCD2:" + this.dsList.getColumn(0, "STCD2") +
	"><J_1KFREPRE:" + this.dsList.getColumn(0, "J_1KFREPRE") +	
	"><J_1KFTBUS:" + this.dsList.getColumn(0, "J_1KFTBUS") +
	"><J_1KFTIND:" + this.dsList.getColumn(0, "J_1KFTIND") +
	"><ZSALES:" + "" +
	"><VKBUR:" + "" +
	"><INCO1:" + "" +
	"><ZTERM:" + "" +
	"><TAXKD:" + "" +
	"><LIFNR:" + this.dsList.getColumn(0, "LIFNR") +
	"><ZSUBRC:" + "" +
	"><TXT:" + "" +
	"><PSTLZ:" + this.dsList.getColumn(0, "PSTLZ") + 
	"><O_RTNCD:" + this.dsExport.getColumn(0, "O_RTNCD") + 
	"><O_RTNMSG:" + this.dsExport.getColumn(0, "O_RTNMSG") + ">";
	/*
	if(this.dsExport.rowcount > 0){
		paramVal = paramVal +
		"<O_RTNCD:" + this.dsExport.getColumn(0, "O_RTNCD") + 
		"><O_RTNMSG:" + this.dsExport.getColumn(0, "O_RTNMSG") + ">";
	}
	*/
	
	this.dsExec.setColumn(0, "PARAM", paramVal);
	
	if (this.dsExec.rowcount == 0) return;
	
	var strSvcId    = "exec";
	var strSvcType  = "save";
	var inProc		= "_dsProc";
	var inData      = "exec=dsExec";
	var outData     = "";
	var strArg      = "";
	var callBackFnc = "fnCallback";
	
	this.gfnTransaction( strSvcId , 	// transaction을 구분하기 위한 svc id값
						strSvcType , 	// transaction을 요청할 구분
						inProc,			// Procedure 정보 Dataset 이름
						inData , 		// 입력값으로 보낼 dataset id , a=b형태로 실제이름과 입력이름을 매칭
						outData , 		// 처리결과값으로 받을 dataset id, a=b형태로 실제이름과 입력이름을 매칭
						strArg, 			// 입력갑스로 보낼 arguments, strFormData="20120607"
						callBackFnc); // 통신방법 정의 [생략가능]
}

this.fnSapVenderUpdate = function() {
	this._dsProcSap.clearData();
	var nrow = this._dsProcSap.addRow();
	this._dsProcSap.setColumn(nrow, "TARGET", "select");
	this._dsProcSap.setColumn(nrow, "SP", "ZERP_SD_0002");
	
	//var listRow = this.dsList.rowposition;
	
	this.dsSap.clearData();
	this.dsSap.addRow();
	this.dsSap.setColumn(0, "IV_KUNNR", this.dsSearch.getColumn(0, "KUNNR"));
		
	this.dsSelectSap.clearData();
	nrow = this.dsSelectSap.addRow();		

	// IN 파라미터 셋팅
	this.dsSelectSap.setColumn(nrow, "KTOKD", this.dsList.getColumn(0, "KTOKD"));
	this.dsSelectSap.setColumn(nrow, "NAME1", this.dsList.getColumn(0, "NAME1"));
	this.dsSelectSap.setColumn(nrow, "SUPPL1", this.dsList.getColumn(0, "SUPPL1"));	// 주소
	this.dsSelectSap.setColumn(nrow, "SUPPL2", this.dsList.getColumn(0, "SUPPL2"));	// 상세주소
	this.dsSelectSap.setColumn(nrow, "LAND1", "KR");
	this.dsSelectSap.setColumn(nrow, "REGIO", this.dsList.getColumn(0, "REGIO"));
	this.dsSelectSap.setColumn(nrow, "STCD1", this.dsList.getColumn(0, "STCD1"));
	this.dsSelectSap.setColumn(nrow, "STCD2", this.dsList.getColumn(0, "STCD2"));
	this.dsSelectSap.setColumn(nrow, "J_1KFREPRE", this.dsList.getColumn(0, "J_1KFREPRE"));	
	this.dsSelectSap.setColumn(nrow, "J_1KFTBUS", this.dsList.getColumn(0, "J_1KFTBUS"));
	this.dsSelectSap.setColumn(nrow, "J_1KFTIND", this.dsList.getColumn(0, "J_1KFTIND"));
	this.dsSelectSap.setColumn(nrow, "ZSALES", "");
	this.dsSelectSap.setColumn(nrow, "VKBUR", "");
	this.dsSelectSap.setColumn(nrow, "INCO1", "");
	this.dsSelectSap.setColumn(nrow, "ZTERM", "");
	this.dsSelectSap.setColumn(nrow, "TAXKD", "");		
	this.dsSelectSap.setColumn(nrow, "LIFNR", this.dsList.getColumn(0, "LIFNR"));
	this.dsSelectSap.setColumn(nrow, "ZSUBRC", "");	
	this.dsSelectSap.setColumn(nrow, "TXT", "");	
	this.dsSelectSap.setColumn(nrow, "PSTLZ", this.dsList.getColumn(0, "PSTLZ"));	
	

	// SAP 호출
	var strSvcId    = "sap_update";
	var strSvcType  = "sap";
	var inProc		= "_dsProcSap";	
	var inData      = "select=dsSap ST_IS_DATA=dsSelectSap";
	//var outData     = "dsExport=export dsList1=TO_FD01";	
	var outData     = "dsExport=export";	
	var strArg      = "";
	var callBackFnc = "fnCallback";
	
	this.gfnTransaction( strSvcId , 	// transaction을 구분하기 위한 svc id값
						strSvcType , 	// transaction을 요청할 구분
						inProc,			// Procedure 정보 Dataset 이름
						inData , 		// 입력값으로 보낼 dataset id , a=b형태로 실제이름과 입력이름을 매칭
						outData , 		// 처리결과값으로 받을 dataset id, a=b형태로 실제이름과 입력이름을 매칭
						strArg, 			// 입력갑스로 보낼 arguments, strFormData="20120607"
						callBackFnc); // 통신방법 정의 [생략가능]
}

// 취소 버튼 클릭
this.divData_btnCancel_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	// this.close()가 작동하지 않았고, 
	// 부모의 callback 함수로 데이터를 넘겨주기 위해 작성되었습니다.
	this.getParentContext().close(false);
};
]]></Script>
    <Objects>
      <Dataset id="_dsProc">
        <ColumnInfo>
          <Column id="TARGET" type="STRING" size="256"/>
          <Column id="SP" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="TARGET">insert</Col>
            <Col id="SP">DQDPR_CUSTOMER_AR_IF_INSERT</Col>
          </Row>
          <Row>
            <Col id="TARGET">exec</Col>
            <Col id="SP">DQDPR_SAP_PARAM_INSERT</Col>
          </Row>
          <Row>
            <Col id="TARGET">update</Col>
            <Col id="SP">DQDPR_CUSTOMER_AR_IF_UPDATE</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="_dsProcSap">
        <ColumnInfo>
          <Column id="TARGET" type="STRING" size="256"/>
          <Column id="SP" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="dsExport"/>
      <Dataset id="dsList">
        <ColumnInfo>
          <Column id="KTOKD" type="STRING" size="256"/>
          <Column id="NAME1" type="STRING" size="256"/>
          <Column id="SUPPL1" type="STRING" size="256"/>
          <Column id="SUPPL2" type="STRING" size="256"/>
          <Column id="LAND1" type="STRING" size="256"/>
          <Column id="REGIO" type="STRING" size="256"/>
          <Column id="STCD2" type="STRING" size="256"/>
          <Column id="J_1KFREPRE" type="STRING" size="256"/>
          <Column id="STCD1" type="STRING" size="256"/>
          <Column id="J_1KFTBUS" type="STRING" size="256"/>
          <Column id="J_1KFTIND" type="STRING" size="256"/>
          <Column id="ZSALES" type="STRING" size="256"/>
          <Column id="VKBUR" type="STRING" size="256"/>
          <Column id="INCO1" type="STRING" size="256"/>
          <Column id="ZTERM" type="STRING" size="256"/>
          <Column id="TAXKD" type="STRING" size="256"/>
          <Column id="PSTLZ" type="STRING" size="256"/>
          <Column id="LIFNR" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="KTOKD"/>
            <Col id="NAME1"/>
            <Col id="SUPPL1"/>
            <Col id="SUPPL2"/>
            <Col id="LAND1">KR</Col>
            <Col id="REGIO"/>
            <Col id="STCD2"/>
            <Col id="J_1KFREPRE"/>
            <Col id="STCD1"/>
            <Col id="J_1KFTBUS"/>
            <Col id="J_1KFTIND"/>
            <Col id="ZSALES"/>
            <Col id="VKBUR"/>
            <Col id="INCO1"/>
            <Col id="ZTERM"/>
            <Col id="TAXKD"/>
            <Col id="PSTLZ"/>
            <Col id="LIFNR"/>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="dsOT_ITAB"/>
      <Dataset id="dsList1"/>
      <Dataset id="dsOT_ADDR"/>
      <Dataset id="dsSearch" onvaluechanged="dsSearch_onvaluechanged">
        <ColumnInfo>
          <Column id="KUNNR" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="KUNNR"/>
          </Row>
        </Rows>
      </Dataset>
    </Objects>
    <Bind>
      <BindItem id="item2" compid="divData.form.ccfKTOKD.form.CDTextBox" propid="value" datasetid="dsList" columnid="KTOKD"/>
      <BindItem id="item7" compid="divData.form.ccfREGIO.form.CDTextBox" propid="value" datasetid="dsList" columnid="REGIO"/>
      <BindItem id="item1" compid="divData.form.ccfINCO1.form.CDTextBox" propid="value" datasetid="dsList" columnid="INCO1"/>
      <BindItem id="item3" compid="divData.form.ccfZTERM.form.CDTextBox" propid="value" datasetid="dsList" columnid="ZTERM"/>
      <BindItem id="item4" compid="divData.form.ctxtNAME1" propid="value" datasetid="dsList" columnid="NAME1"/>
      <BindItem id="item6" compid="divData.form.ctxtSUPPL2" propid="value" datasetid="dsList" columnid="SUPPL2"/>
      <BindItem id="item9" compid="divData.form.ctxtSTCD2" propid="value" datasetid="dsList" columnid="STCD2"/>
      <BindItem id="item10" compid="divData.form.ctxtJ_1KFREPRE" propid="value" datasetid="dsList" columnid="J_1KFREPRE"/>
      <BindItem id="item11" compid="divData.form.ctxtJ_1KFTBUS" propid="value" datasetid="dsList" columnid="J_1KFTBUS"/>
      <BindItem id="item12" compid="divData.form.ctxtSTCD1" propid="value" datasetid="dsList" columnid="STCD1"/>
      <BindItem id="item13" compid="divData.form.ctxtJ_1KFTIND" propid="value" datasetid="dsList" columnid="J_1KFTIND"/>
      <BindItem id="item0" compid="divData.form.ccfPSTLZ.form.CDTextBox" propid="value" datasetid="dsList" columnid="PSTLZ"/>
      <BindItem id="item5" compid="divData.form.ccfPSTLZ.form.DSTextBox" propid="value" datasetid="dsList" columnid="SUPPL1"/>
    </Bind>
  </Form>
</FDL>
