<?xml version="1.0" encoding="utf-8"?>
<FDL version="2.0">
  <Form id="form" width="900" height="1020" titletext="작업허가서상세" onload="form_onload">
    <Layouts>
      <Layout>
        <Div id="divSearch" taborder="0" left="0.0" top="10.0" height="46.0" right="0" cssclass="div_SEARCH_Bg" formscrolltype="none">
          <Layouts>
            <Layout>
              <Static id="staCD_SITE" taborder="0" text="현장코드" left="0.0" top="10.0" width="92.0" height="24.0" textAlign="center" cssclass="sta_WF_SchLabelE"/>
              <Div id="ccfCD_SITE" CodeFindName="DZX_CFSITE" CDTextWidth="100" taborder="1" left="staCD_SITE:0.0" top="10.0" width="350" height="24.0" FitToContents="true" url="cmm::cmmCodeFind.xfdl" readonly="true" enable="false"/>
              <Static id="staNO_SEQ" taborder="2" text="문서번호" left="ccfCD_SITE:0.0" top="10.0" width="92.0" height="24.0" textAlign="center" cssclass="sta_WF_SchLabelE"/>
              <Edit id="ctxtNO_SEQ" taborder="3" left="staNO_SEQ:0.0" top="10.0" width="80" height="24.0" enable="false"/>
            </Layout>
          </Layouts>
        </Div>
        <Div id="divData" taborder="0" left="0" top="divSearch:10" bottom="0" right="0" cssclass="div_DATA_Bg" text="">
          <Layouts>
            <Layout>
              <Static id="staBgRISK_LABEL2" taborder="16" left="0" top="99" width="897" height="65" cssclass="sta_WF_tablebg" font="24px/normal &quot;Arial&quot;" textAlign="center" text=""/>
              <Static id="staDS_VENDOR" taborder="0" text="협력업체" left="0" width="150" height="30" cssclass="sta_WF_tablelabel" textAlign="center" top="staBgRISK_LABEL2:-1"/>
              <Static id="staBgDS_VENDOR" taborder="15" left="staDS_VENDOR:-1" top="staBgRISK_LABEL2:-1" width="300" height="30" cssclass="sta_WF_tablebg"/>
              <Edit id="ctxtDS_VENDOR" taborder="27" left="staDS_VENDOR:4" top="staBgRISK_LABEL2:4" height="20" width="210" enable="true"/>
              <Static id="staDS_GONGJONG" taborder="3" text="작업공종" left="0" width="150" height="30" cssclass="sta_WF_tablelabel" textAlign="center" top="staDS_VENDOR:-1"/>
              <Static id="staBgDS_GONGJONG" taborder="23" left="staDS_GONGJONG:-1" top="staBgDS_VENDOR:-1" width="300" height="30" cssclass="sta_WF_tablebg"/>
              <Edit id="ctxtDS_GONGJONG" taborder="26" left="staDS_GONGJONG:4" top="staBgDS_VENDOR:4" height="20" autoselect="true" width="210" enable="true"/>
              <Static id="staDT_WORK_FR" taborder="24" text="시작일" left="0" width="150" height="30" cssclass="sta_WF_tablelabel" textAlign="center" top="staDS_GONGJONG:-1"/>
              <Static id="staBgDT_WORK_FR" taborder="25" width="300" cssclass="sta_WF_tablebg" left="staDT_WORK_FR:-1" top="staBgDS_GONGJONG:-1" height="30"/>
              <Static id="staDT_WORK_TO" taborder="10" text="종료일" left="0" width="150" height="30" cssclass="sta_WF_tablelabel" textAlign="center" top="staDT_WORK_FR:-1"/>
              <Static id="staBgDT_WORK_TO" taborder="12" left="staDT_WORK_TO:-1" top="staBgDT_WORK_FR:-1" width="300" height="30" cssclass="sta_WF_tablebg"/>
              <Static id="staDS_WRITER" taborder="11" text="작성자" left="staBgDS_VENDOR:-1" width="150" height="30" cssclass="sta_WF_tablelabel" textAlign="center" top="staBgRISK_LABEL2:-1"/>
              <Static id="staBgDS_WRITER" taborder="13" left="staDS_WRITER:-1" top="staBgRISK_LABEL2:-1" width="300" height="30" cssclass="sta_WF_tablebg"/>
              <Static id="staDS_MANAGER" taborder="9" text="작업담당자" left="0" width="150" height="30" cssclass="sta_WF_tablelabel" textAlign="center" top="staDT_WORK_TO:-1"/>
              <Static id="staBgDS_MANAGER" taborder="21" left="staDS_MANAGER:-1" top="staBgDT_WORK_TO:-1" width="300" height="30" cssclass="sta_WF_tablebg"/>
              <Static id="staDS_MANAGER_TEL" taborder="7" text="연락처" left="0" width="150" height="30" cssclass="sta_WF_tablelabel" textAlign="center" top="staDS_MANAGER:-1"/>
              <Static id="staBgDS_MANAGER_TEL" taborder="17" left="staDS_MANAGER_TEL:-1" top="staBgDS_MANAGER:-1" height="30" cssclass="sta_WF_tablebg" width="300"/>
              <Static id="staDS_WORKCONTENT" taborder="6" text="주요 작업내용" left="0" width="150" height="60" cssclass="sta_WF_tablelabel" textAlign="center" top="staDS_MANAGER_TEL:-1"/>
              <Static id="staBgDS_WORKCONTENT" taborder="20" left="staDS_WORKCONTENT:-1" top="staBgDS_MANAGER_TEL:-1" width="748" height="60" cssclass="sta_WF_tablebg"/>
              <Static id="staDS_WORKSAFE" taborder="5" text="안전 조치사항" left="0" width="150" height="60" cssclass="sta_WF_tablelabel" textAlign="center" top="staDS_WORKCONTENT:-1"/>
              <Static id="staBgDS_WORKSAFE" taborder="22" left="staDS_WORKSAFE:-1" top="staBgDS_WORKCONTENT:-1" width="748" height="60" cssclass="sta_WF_tablebg" text=""/>
              <Static id="staDS_APPROVAL" taborder="4" text="검토의견" left="0" width="120" height="80" cssclass="sta_WF_tablelabel" textAlign="center" top="staDS_WORKSAFE:-1"/>
              <Static id="staDS_WORKAREA" taborder="2" text="작업장소" left="staBgDS_GONGJONG:-1" width="150" height="30" cssclass="sta_WF_tablelabel" textAlign="center" top="staBgDS_WRITER:-1"/>
              <Static id="staBgDS_WORKAREA" taborder="18" left="staDS_WORKAREA:-1" top="staBgDS_WRITER:-1" width="300" height="30" cssclass="sta_WF_tablebg"/>
              <Static id="staNO_WORKER" taborder="1" text="작업인원" left="staBgDT_WORK_FR:-1" width="150" height="30" cssclass="sta_WF_tablelabel" textAlign="center" top="staDS_WORKAREA:-1"/>
              <Static id="staBgNO_WORKER" taborder="14" left="staNO_WORKER:-1" top="staBgDS_WORKAREA:-1" width="300" height="30" cssclass="sta_WF_tablebg"/>
              <Edit id="ctxtNO_WORKER" taborder="28" left="staNO_WORKER:4" top="staBgDS_WORKAREA:4" height="20" autoselect="true" width="100" enable="true" textAlign="right"/>
              <Static id="staDS_WORKDEVICE" taborder="8" text="사용장비" left="staBgDT_WORK_TO:-1" width="150" height="88" cssclass="sta_WF_tablelabel" textAlign="center" top="staNO_WORKER:-1"/>
              <Static id="staBgDS_WORKDEVICE" taborder="19" left="staDS_WORKDEVICE:-1" top="staBgNO_WORKER:-1" width="300" height="88" cssclass="sta_WF_tablebg"/>
              <Edit id="ctxtDS_WORKDEVICE" taborder="29" left="staDS_WORKDEVICE:4" top="staBgNO_WORKER:4" height="78" autoselect="true" width="290" enable="true"/>
              <Edit id="ctxtDS_WRITER" taborder="30" left="staDS_WRITER:4" top="staBgRISK_LABEL2:4" height="20" autoselect="false" width="210" enable="true"/>
              <Edit id="ctxtDS_WORKAREA" taborder="31" left="staDS_WORKAREA:4" top="staBgDS_WRITER:4" height="20" autoselect="false" width="210" enable="true"/>
              <Edit id="ctxtDS_MANAGER" taborder="32" left="staDS_MANAGER:4" top="staBgDT_WORK_TO:4" height="20" autoselect="false" width="210" enable="true"/>
              <Edit id="ctxtDS_WORKCONTENT" taborder="34" left="staDS_WORKCONTENT:4" top="staBgDS_MANAGER_TEL:4" height="50" autoselect="false" width="738" enable="true"/>
              <Edit id="ctxtDS_WORKSAFE" taborder="35" left="staDS_WORKSAFE:4" top="staBgDS_WORKCONTENT:4" height="50" autoselect="false" width="738" enable="true"/>
              <Static id="staDS_APPROVALGONGSA" taborder="36" text="공사" left="staDS_APPROVAL:-1" width="90" height="40" cssclass="sta_WF_tablelabel" textAlign="center" top="staDS_WORKSAFE:-1"/>
              <Static id="staDS_APPROVALSAFER" taborder="37" text="안전" left="staDS_APPROVAL:-1" width="90" height="40" cssclass="sta_WF_tablelabel" textAlign="center" top="staDS_APPROVALGONGSA:-1"/>
              <Static id="staBgDS_APPROVALGONGSA" taborder="38" left="staDS_APPROVALGONGSA:-1" top="staBgDS_WORKSAFE:-1" width="689" height="40" cssclass="sta_WF_tablebg"/>
              <Static id="staBgDS_APPROVALSAFER" taborder="39" left="staDS_APPROVALSAFER:-1" top="staBgDS_APPROVALGONGSA:-1" width="689" height="40" cssclass="sta_WF_tablebg"/>
              <Static id="staBgRISK_LABEL1" taborder="40" left="0" top="0" width="897" height="100" cssclass="sta_WF_tablebg" text=" ■ 작업 허가서 작성 절차&#13;&#10;     1. 작업 실시 전 협력업체 담당자 작성(음영부분)&#13;&#10;     2. 작성 후 공사팀(관리감독자) 제출&#13;&#10;     3. 공사팀 점검확인 및 검토의견 작성 후 안전팀 제출&#13;&#10;     4. 안전팀 첨부자료 및 검토의견 작성 후 본사 제출&#13;&#10;       ( ※ P.T.W 중 10개 항목 중 본사보고 7개 항목해당)" font="11px/normal &quot;Arial&quot;" textAlign="left" onclick="divData_staBgDS_SCRIVENER00_onclick"/>
              <Edit id="ctxtDS_APPROVALGONGSA" taborder="41" left="staDS_APPROVALGONGSA:4" top="staBgDS_WORKSAFE:4" height="30" autoselect="false" width="679"/>
              <Edit id="ctxtDS_APPROVALSAFER" taborder="42" left="staDS_APPROVALSAFER:4" top="staBgDS_APPROVALGONGSA:4" height="30" autoselect="false" width="679"/>
              <Calendar id="ctclDT_WORK_FR" taborder="43" left="staDT_WORK_FR:4" top="staBgDS_GONGJONG:4" height="20" dateformat="yyyy-MM-dd" editformat="yyyyMMdd" autoselect="false" value="20210101" width="110"/>
              <MaskEdit id="ctxtHM_WORK_FR" taborder="44" top="staBgDS_GONGJONG:4" width="50" height="20" format="##:##" type="string" autoselect="false" maskchar="-" left="ctclDT_WORK_FR:4"/>
              <MaskEdit id="ctxtHM_WORK_TO" taborder="45" left="268" top="260" width="50" height="20" format="##:##" type="string" autoselect="false" maskchar="-"/>
              <Calendar id="ctclDT_WORK_TO" taborder="46" left="staDT_WORK_TO:4" top="260" height="20" dateformat="yyyy-MM-dd" editformat="yyyyMMdd" autoselect="false" value="20210101" width="110"/>
              <Static id="sta00" taborder="47" text="명" left="ctxtNO_WORKER:5" top="staBgDS_WORKAREA:4" width="25" height="20"/>
              <Edit id="ctxtDS_MANAGER_TEL" taborder="47" left="staDS_MANAGER_TEL:4" top="staBgDS_MANAGER:4" height="20" autoselect="false" width="210" enable="true"/>
              <Grid id="objGrid" taborder="48" left="0" top="staBgDS_APPROVALSAFER:10" height="250" width="898"/>
              <Grid id="objGrid1" taborder="49" left="0" top="objGrid:10" height="150" width="898" enableevent="true"/>
            </Layout>
          </Layouts>
        </Div>
      </Layout>
    </Layouts>
    <Script type="xscript5.1"><![CDATA[this.objApp = this.gfnGetApplication();

this.form_onload = function(obj:nexacro.Form,e:nexacro.LoadEventInfo)
{
	// -- 필수 -------------------//
	this.gfnFormOnLoad(this);	
	this.gfnFormInfo(this);		
	// ---------------------------//
	
	this.fnSetButton();
	this.fnSetExtendButton();
	this.fnSetVariable();
	this.fnSetEvent();
	this.fnSetParameter();
	
	
	if(!this.gfnIsNull(this.getOwnerFrame().CD_SITE) && !this.gfnIsNull(this.getOwnerFrame().NO_SEQ)) {	
	    
		this.dsSearch.setColumn(0, "CD_SITE", this.getOwnerFrame().CD_SITE);
		this.dsSearch.setColumn(0, "DS_SITE", this.getOwnerFrame().DS_SITE);
		this.dsSearch.setColumn(0, "NO_SEQ", this.getOwnerFrame().NO_SEQ);
		this.dsList.setColumn(0, "TY_WORK", this.getOwnerFrame().TY_WORK);
		this.dsList.setColumn(0, "DS_WORK", this.getOwnerFrame().DS_WORK);
		//this.divData.form.staBgRISK_LABEL2.set_text(this.getOwnerFrame().TY_WORK);
		
		
		this.fnSelect();	
		
	}
	
};

/************************************************************************
 * 버튼 설정 : 화면(Tab) 전환시 마다 호출
 * 서브버튼 사용 및 공통버튼 강제 제어시 여기서 처리
 ************************************************************************/
this.fnSetButton = function() {
}

/************************************************************************
 * 확장 버튼 : 화면별 버튼 설정 ID, function 연결 (화면버튼관리)
 ************************************************************************/
this.fnSetExtendButton = function() {
	this.btnAPP = this.gfnFormButtonAdd("btnAPP", "fnAPP"); 	// 전자결재
};

/************************************************************************
 * 변수 선언
 ************************************************************************/
this.fnSetVariable = function() {
	this.ccfCD_SITE    = this.divSearch.form.ccfCD_SITE;
	this.ctxtNO_SEQ    = this.divSearch.form.ctxtNO_SEQ;
	
	this.ctxtDS_VENDOR         = this.divData.form.ctxtDS_VENDOR;
	this.ctxtDS_WRITER         = this.divData.form.ctxtDS_WRITER;
	this.ctxtDS_GONGJONG       = this.divData.form.ctxtDS_GONGJONG;
	this.ctxtDS_WORKAREA       = this.divData.form.ctxtDS_WORKAREA;
	this.ctclDT_WORK_FR        = this.divData.form.ctclDT_WORK_FR;
	this.ctclDT_WORK_TO        = this.divData.form.ctclDT_WORK_TO;
	this.ctxtHM_WORK_FR        = this.divData.form.ctxtHM_WORK_FR;
	this.ctxtHM_WORK_TO        = this.divData.form.ctxtHM_WORK_TO;
	this.ctxtNO_WORKER         = this.divData.form.ctxtNO_WORKER;
	this.ctxtDS_MANAGER_TEL    = this.divData.form.ctxtDS_MANAGER_TEL;
	this.ctxtDS_APPROVALGONGSA = this.divData.form.ctxtDS_APPROVALGONGSA;
	this.ctxtDS_APPROVALSAFER  = this.divData.form.ctxtDS_APPROVALSAFER;
	
	this.dxGrid = this.divData.form.objGrid;
	this.dxGrid1 = this.divData.form.objGrid1;
};

/************************************************************************
 * 이벤트 설정
 ************************************************************************/
this.fnSetEvent = function() {
	
	this.gfnGridInit(this.dxGrid, this.dsList1, "DW", "DWG_RISKWORK_CHECK");
	this.gfnGridInit(this.dxGrid1, this.dsList2, "DW", "DWG_RISKWORK_FILE");
	
	// BUTTON, BUTTON-IN 처리
	this.dxGrid1.ExpandUp = "fnGrid_ExpandUp";
};

/************************************************************************
 * 파라미터 설정
 ************************************************************************/
this.fnSetParameter = function() {

    
	this.dsSelect = new Dataset();
	this.dsSelect.addColumn("TY_WRK", "string");
	this.dsSelect.addColumn("CD_SITE", "string");
	this.dsSelect.addColumn("NO_SEQ", "string");

	this.dsSave = new Dataset();
	this.dsSave.addColumn("TY_WRK", "string");
	this.dsSave.addColumn("CD_SITE", "string");
	this.dsSave.addColumn("NO_SEQ", "int");
	this.dsSave.addColumn("CD_CORP", "string");
	this.dsSave.addColumn("TY_WORK", "string");
	this.dsSave.addColumn("DS_WRITER", "string");
	this.dsSave.addColumn("CD_VENDOR", "string");
	this.dsSave.addColumn("DS_VENDOR", "string");
	this.dsSave.addColumn("DS_GONGJONG", "string");
	this.dsSave.addColumn("DS_WORKAREA", "string");
	this.dsSave.addColumn("DT_WORKTIME_FR", "string");
	this.dsSave.addColumn("DT_WORKTIME_TO", "string");
	this.dsSave.addColumn("DT_WORKTIMEHHMM_FR", "string");
	this.dsSave.addColumn("DT_WORKTIMEHHMM_TO", "string");
	this.dsSave.addColumn("NO_WORKER", "int");
	this.dsSave.addColumn("DS_MANAGER", "string");
	this.dsSave.addColumn("DS_MANAGER_TEL", "string");
	this.dsSave.addColumn("DS_WORKDEVICE", "string");
	this.dsSave.addColumn("DS_WORKCONTENT", "string");
	this.dsSave.addColumn("DS_WORKSAFE", "string");
	this.dsSave.addColumn("DS_APPROVALGONGSA", "string");
	this.dsSave.addColumn("DS_APPROVALSAFER", "string");
	this.dsSave.addColumn("TY_APPROVAL", "string");
	this.dsSave.addColumn("ID_USER", "string");
	
	this.dsSave1 = new Dataset();
	this.dsSave1.addColumn("TY_WRK", "string");
	this.dsSave1.addColumn("CD_SITE", "string");
	this.dsSave1.addColumn("TY_WORK", "string");
	this.dsSave1.addColumn("NO_SEQ", "int");
	this.dsSave1.addColumn("NO_CHKLIST", "string");
	this.dsSave1.addColumn("TY_CHK", "string");
	//this.dsSave1.addColumn("AUTH_CD_CORP", "string");
	//this.dsSave1.addColumn("AUTH_ID_USER", "string");
	
	this.dsSave2 = new Dataset();
	this.dsSave2.addColumn("TY_WRK", "string");
	this.dsSave2.addColumn("CD_SITE", "string");
	this.dsSave2.addColumn("TY_WORK", "string");
	this.dsSave2.addColumn("NO_SEQ", "int");
	this.dsSave2.addColumn("NO_FILELIST", "string");
	this.dsSave2.addColumn("DS_FILE", "string");
	//this.dsSave2.addColumn("AUTH_CD_CORP", "string");
	//this.dsSave2.addColumn("AUTH_ID_USER", "string");
};

/************************************************************************
 * 컨트롤 이벤트
 ************************************************************************/
 /*
  *	조회 버튼
  */
this.fnSelect = function() {
	//if (!this.fnSelectValidate()) return false;
	
	this.dsSelect.clearData();
	this.dsSelect.addRow();
	
	this.dsSelect.setColumn(0, "TY_WRK", "Q");
	this.dsSelect.setColumn(0, "CD_SITE", this.dsSearch.getColumn(0, "CD_SITE"));
	this.dsSelect.setColumn(0, "NO_SEQ", this.dsSearch.getColumn(0, "NO_SEQ"));
	
	var strSvcId    = "select";
	var strSvcType  = "grid";
	var inProc		= "_dsProc";
	var inData      = "select=dsSelect select1=dsSelect select2=dsSelect";
	var outData     = "dsList=select0 dsList1=select10 dsList2=select20";
	var strArg      = "";
	var callBackFnc = "fnCallback";
	
	this.gfnTransaction( strSvcId , 	// transaction을 구분하기 위한 svc id값
						strSvcType , 	// transaction을 요청할 구분
						inProc,			// Procedure 정보 Dataset 이름
						inData , 		// 입력값으로 보낼 dataset id , a=b형태로 실제이름과 입력이름을 매칭
						outData , 		// 처리결과값으로 받을 dataset id, a=b형태로 실제이름과 입력이름을 매칭
						strArg, 			// 입력갑스로 보낼 arguments, strFormData="20120607"
						callBackFnc); // 통신방법 정의 [생략가능]
};



/*
 *	입력 버튼
 */
this.fnAdd = function() {
};

/*
 *	삭제 버튼
 */
this.fnDel = function() {
	this.gfnsetformstatus(this, "D");
};

/*
 *	저장 버튼
 */
this.fnSave = function() {
	// 그리드 필수항목 체크``
	if (!this.gfnGridValidate(this.dxGrid)) return;		
	if (!this.gfnGridValidate(this.dxGrid1)) return;	
	
	this.dxGrid.updateToDataset();	
	this.dxGrid1.updateToDataset();
	
	var arr_in = [];
	
	this.dsSave.clearData();
	
	var flag = this.gfnGetFormStatus(this);		
	switch(flag) {
		case "I":
		case "U":
			var nrow = this.dsSave.addRow();
			this.dsSave.setColumn(nrow, "TY_WRK", flag);
			this.dsSave.setColumn(nrow, "CD_SITE", this.dsSearch.getColumn(0, "CD_SITE"));
			this.dsSave.setColumn(nrow, "NO_SEQ", this.dsSearch.getColumn(0, "NO_SEQ"));
			this.dsSave.setColumn(nrow, "CD_CORP", this.dsSearch.getColumn(0, "CD_CORP"));
			this.dsSave.setColumn(nrow, "TY_WORK", this.dsList.getColumn(0, "TY_WORK"));
			this.dsSave.setColumn(nrow, "DS_WRITER", this.dsList.getColumn(0, "DS_WRITER"));
			this.dsSave.setColumn(nrow, "CD_VENDOR", this.dsList.getColumn(0, "CD_VENDOR"));
			this.dsSave.setColumn(nrow, "DS_VENDOR", this.dsList.getColumn(0, "DS_VENDOR"));
			this.dsSave.setColumn(nrow, "DS_GONGJONG", this.dsList.getColumn(0, "DS_GONGJONG"));
			this.dsSave.setColumn(nrow, "DS_WORKAREA", this.dsList.getColumn(0, "DS_WORKAREA"));
			this.dsSave.setColumn(nrow, "DT_WORKTIME_FR", this.dsList.getColumn(0, "DT_WORKTIME_FR"));
			this.dsSave.setColumn(nrow, "DT_WORKTIME_TO", this.dsList.getColumn(0, "DT_WORKTIME_TO"));
			this.dsSave.setColumn(nrow, "DT_WORKTIMEHHMM_FR", this.dsList.getColumn(0, "DT_WORKTIMEHHMM_FR"));
			this.dsSave.setColumn(nrow, "DT_WORKTIMEHHMM_TO", this.dsList.getColumn(0, "DT_WORKTIMEHHMM_TO"));
			this.dsSave.setColumn(nrow, "NO_WORKER", this.dsList.getColumn(0, "NO_WORKER"));
			this.dsSave.setColumn(nrow, "DS_MANAGER", this.dsList.getColumn(0, "DS_MANAGER"));
			this.dsSave.setColumn(nrow, "DS_MANAGER_TEL", this.dsList.getColumn(0, "DS_MANAGER_TEL"));
			this.dsSave.setColumn(nrow, "DS_WORKDEVICE", this.dsList.getColumn(0, "DS_WORKDEVICE"));
			this.dsSave.setColumn(nrow, "DS_WORKCONTENT", this.dsList.getColumn(0, "DS_WORKCONTENT"));
			this.dsSave.setColumn(nrow, "DS_WORKSAFE", this.dsList.getColumn(0, "DS_WORKSAFE"));
			this.dsSave.setColumn(nrow, "DS_APPROVALGONGSA", this.dsList.getColumn(0, "DS_APPROVALGONGSA"));
			this.dsSave.setColumn(nrow, "DS_APPROVALSAFER", this.dsList.getColumn(0, "DS_APPROVALSAFER"));
			this.dsSave.setColumn(nrow, "TY_APPROVAL", this.dsList.getColumn(0, "TY_APPROVAL"));
			this.dsSave.setColumn(nrow, "ID_USER", this.AuthClient.ID_USER);
			break;

			
	}
	
	if(this.dsSave.rowcount > 0) {
		arr_in.push("save=dsSave");
	}	
	
	// save SP 한개로 사용하는 경우
	this.dsSave1.clearData();
	
	for (var i = 0; i < this.dsList1.rowcount; i++) {
		var flag = this.gfnGetFlag(this.dsList1, i);
		switch(flag) {
			case "I":
			case "U":
			case "D":
				var nrow = this.dsSave1.addRow();
				this.dsSave1.setColumn(nrow, "TY_WRK", flag);
				this.dsSave1.setColumn(nrow, "CD_SITE", this.dsList1.getColumn(i, "CD_SITE"));
				this.dsSave1.setColumn(nrow, "TY_WORK", this.dsList1.getColumn(i, "TY_WORK"));
				this.dsSave1.setColumn(nrow, "NO_SEQ", this.dsList1.getColumn(i, "NO_SEQ"));
				this.dsSave1.setColumn(nrow, "NO_CHKLIST", this.dsList1.getColumn(i, "NO_CHKLIST"));
				this.dsSave1.setColumn(nrow, "TY_CHK", this.dsList1.getColumn(i, "TY_CHK"));
				//this.dsSave1.setColumn(nrow, "AUTH_CD_CORP", this.dsList1.getColumn(i, "AUTH_CD_CORP"));
				//this.dsSave1.setColumn(nrow, "AUTH_ID_USER", this.dsList1.getColumn(i, "AUTH_ID_USER"));
				break;
		}
	}
	
	if(this.dsSave1.rowcount > 0) {
		arr_in.push("save1=dsSave1");
	}
	
	// save SP 한개로 사용하는 경우
	this.dsSave2.clearData();
	
	for (var i = 0; i < this.dsList2.rowcount; i++) {
		var flag = this.gfnGetFlag(this.dsList2, i);
		switch(flag) {
			case "I":
			case "U":
			case "D":
				var nrow = this.dsSave2.addRow();
				this.dsSave2.setColumn(nrow, "TY_WRK", flag);
				this.dsSave2.setColumn(nrow, "CD_SITE", this.dsList2.getColumn(i, "CD_SITE"));
				this.dsSave2.setColumn(nrow, "TY_WORK", this.dsList2.getColumn(i, "TY_WORK"));
				this.dsSave2.setColumn(nrow, "NO_SEQ", this.dsList2.getColumn(i, "NO_SEQ"));
				this.dsSave2.setColumn(nrow, "NO_FILELIST", this.dsList2.getColumn(i, "NO_FILELIST"));
				this.dsSave2.setColumn(nrow, "DS_FILE", this.dsList2.getColumn(i, "DS_FILE"));
				//this.dsSave2.setColumn(nrow, "AUTH_CD_CORP", this.dsList2.getColumn(i, "AUTH_CD_CORP"));
				//this.dsSave2.setColumn(nrow, "AUTH_ID_USER", this.dsList2.getColumn(i, "AUTH_ID_USER"));
				break;
		}
	}
	
	if(this.dsSave2.rowcount > 0) {
		arr_in.push("save2=dsSave2");
	}	

	if (this.dsSave.rowcount == 0 && this.dsSave1.rowcount == 0 && this.dsSave2.rowcount == 0) return;	
		
	var strSvcId    = "save";
	var strSvcType  = "save";
	var inProc		= "_dsProc";
	//var inData      = "save=dsSave";
	var inData      = arr_in.join(' ');
	var outData     = "";
	var strArg      = "";
	var callBackFnc = "fnCallback";
	
	this.gfnTransaction( strSvcId , 	// transaction을 구분하기 위한 svc id값
						strSvcType , 	// transaction을 요청할 구분
						inProc,			// Procedure 정보 Dataset 이름
						inData , 		// 입력값으로 보낼 dataset id , a=b형태로 실제이름과 입력이름을 매칭
						outData , 		// 처리결과값으로 받을 dataset id, a=b형태로 실제이름과 입력이름을 매칭
						strArg, 			// 입력갑스로 보낼 arguments, strFormData="20120607"
						callBackFnc); // 통신방법 정의 [생략가능]
};

/*
 *	엑셀 버튼
 */
this.fnExcel = function() {
	this.gfnExcelExport(this.dxGrid);
}

/*
 *	출력 버튼
 */
this.fnPrint = function() {
}

/************************************************************************
 * Validate
 ************************************************************************/
/*
 *	조회 Validate
 */
 /*
this.fnSelectValidate = function() {
	var validate = true;
	return validate;
};

this.fnSaveValidate = function() {
	var validate = true;
	return validate;
}
*/
/************************************************************************
 * 콜백 이벤트
 ************************************************************************/
/*
 *	콜백 처리
 */
this.fnCallback = function(svcID, errorCode, errorMsg)
{
	if (svcID == "select") {
		//this.gfnGridAfterSelect(this.dxGrid);
	 
	}
	else if(svcID == "save") {
		if (errorCode == 0) {
			this.FormBtns.Select.click();
		}
		else {
			this.gfnAlert(errorMsg);
		}
	}
}

/************************************************************************
 * 코드파인드 이벤트
 ************************************************************************/

/************************************************************************
 * 그리드 이벤트
 ************************************************************************/
 this.fnGrid_ExpandUp = function(obj:nexacro.Grid, e:nexacro.GridMouseEventInfo) {

	var colnm = this.gfnGridGetBindColumnNameByIndex(obj, e.cell);
	
	if(colnm == "DS_FILE") {
		// 최초 작성시엔 NO_SEQ가 없기 때문에 저장 후에 파일 첨부를 진행하여야 함.
		// CD_DIR에 넣어줄 값이 없기에 저장 후 진행!
		if(this.gfnGetFlag(this.dsList2, e.row) == "I"){
			this.gfnAlert("저장 후 파일첨부 진행.");
			return false;
		}
	
		var fileManager = {};
		fileManager.CD_GUBUN = "DWS1";
		fileManager.CD_DIR = [this.dsList2.getColumn(e.row, "CD_SITE"), this.dsList2.getColumn(e.row, "NO_SEQ"), this.dsList2.getColumn(e.row, "NO_FILELIST")];
		fileManager.IS_READONLY = false;
		this.gfnFileManager(fileManager, "fnFileCallback");
	}
}

this.fnFileCallback = function(strID, val) {
	// val.IsChange : 변경여부, val.Cnt : 파일개수
	
	// 변경시 조회를 다시 하거나
// 	if(val.IsChange == true) {
// 		this.FormBtns.Select.click();
// 	}
	
	// 파일개수를 다시 셋팅
	this.dsList2.set_enableevent(false);
	if(val.Cnt == 0) {
		this.dsList2.setColumn(this.dsList2.rowposition, "DS_FILE", "첨부");
	} else {
		this.dsList2.setColumn(this.dsList2.rowposition, "DS_FILE", "첨부(" + val.Cnt + ")");
	}
	this.dsList2.set_enableevent(true);
};

/************************************************************************
 * 기타 이벤트
 ************************************************************************/
this.dsSearch_onvaluechanged = function(obj:nexacro.NormalDataset,e:nexacro.DSColChangeEventInfo)
{
	if(e.oldvalue != e.newvalue) {
		this.gfnSetFormStatus(this);	// 폼상태 초기화
		
	}
};


this.fnAPP = function(obj:nexacro.Button,e:nexacro.ClickEventInfo) {
	
	var param = {};
	param.V1 = this.dsSearch.getColumn(0, "CD_SITE");
	param.V2 = this.dsSearch.getColumn(0, "NO_SEQ");
	param.V3 = "";
	param.V4 = "";
	param.ID_AP = this.dsList.getColumn(0, "NO_ELAPDOC");	// 전자결재문서번호
	param.DS_ETITLE = "개인별실적등록";

	this.gfnFormOpen("DWG", "DWG_RISKWORK_1_APP", "fnAprvDialogCallback", param, 1200, 700);
	
};


 this.fnAprvDialogCallback = function(svcID, value) {
	// 리턴값
	//if(value){
		// 결재완료, 결재취소, 결재상신 후에는 재조회를 한다
		this.FormBtns.Select.click();
	//}
};




]]></Script>
    <Objects>
      <Dataset id="_dsProc">
        <ColumnInfo>
          <Column id="TARGET" type="STRING" size="256"/>
          <Column id="SP" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="TARGET">select</Col>
            <Col id="SP">DWGPR_RISKWORK_SELECT</Col>
          </Row>
          <Row>
            <Col id="TARGET">save</Col>
            <Col id="SP">DWGPR_RISKWORK_SAVE</Col>
          </Row>
          <Row>
            <Col id="TARGET">select1</Col>
            <Col id="SP">DWGPR_RISKWORK_CHECK_SELECT</Col>
          </Row>
          <Row>
            <Col id="TARGET">save1</Col>
            <Col id="SP">DWGPR_RISKWORK_CHECK_SAVE</Col>
          </Row>
          <Row>
            <Col id="TARGET">select2</Col>
            <Col id="SP">DWGPR_RISKWORK_FILE_SELECT</Col>
          </Row>
          <Row>
            <Col id="TARGET">save2</Col>
            <Col id="SP">DWGPR_RISKWORK_FILE_SAVE</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="dsSearch" onvaluechanged="dsSearch_onvaluechanged">
        <ColumnInfo>
          <Column id="CD_SITE" type="STRING" size="256"/>
          <Column id="DS_SITE" type="STRING" size="256"/>
          <Column id="NO_SEQ" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row/>
        </Rows>
      </Dataset>
      <Dataset id="dsList" onvaluechanged="dsList_onvaluechanged">
        <ColumnInfo>
          <Column id="TY_WRK" type="STRING" size="256"/>
          <Column id="CD_SITE" type="STRING" size="256"/>
          <Column id="NO_SEQ" type="STRING" size="256"/>
          <Column id="CD_CORP" type="STRING" size="256"/>
          <Column id="TY_WORK" type="STRING" size="256"/>
          <Column id="DS_WORK" type="STRING" size="256"/>
          <Column id="CD_VENDOR" type="STRING" size="256"/>
          <Column id="DS_VENDOR" type="STRING" size="256"/>
          <Column id="DS_WRITER" type="STRING" size="256"/>
          <Column id="DS_GONGJONG" type="STRING" size="256"/>
          <Column id="DS_WORKAREA" type="STRING" size="256"/>
          <Column id="DT_WORKTIME_FR" type="STRING" size="256"/>
          <Column id="DT_WORKTIME_TO" type="STRING" size="256"/>
          <Column id="NO_WORKER" type="STRING" size="256"/>
          <Column id="DS_MANAGER" type="STRING" size="256"/>
          <Column id="DS_MANAGER_TEL" type="STRING" size="256"/>
          <Column id="DS_WORKDEVICE" type="STRING" size="256"/>
          <Column id="DS_WORKCONTENT" type="STRING" size="256"/>
          <Column id="DS_WORKSAFE" type="STRING" size="256"/>
          <Column id="DS_APPROVALGONGSA" type="STRING" size="256"/>
          <Column id="DS_APPROVALSAFER" type="STRING" size="256"/>
          <Column id="DT_WORKTIMEHHMM_FR" type="STRING" size="256"/>
          <Column id="DT_WORKTIMEHHMM_TO" type="STRING" size="256"/>
          <Column id="ID_USER" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="dsList1" onvaluechanged="dsList_onvaluechanged"/>
      <Dataset id="dsList2" onvaluechanged="dsList_onvaluechanged"/>
    </Objects>
    <Bind>
      <BindItem id="item0" compid="divSearch.form.ccfCD_SITE.form.CDTextBox" propid="value" datasetid="dsSearch" columnid="CD_SITE"/>
      <BindItem id="item1" compid="divSearch.form.ccfCD_SITE.form.DSTextBox" propid="value" datasetid="dsSearch" columnid="DS_SITE"/>
      <BindItem id="item2" compid="divData.form.ctxtDS_VENDOR" propid="value" datasetid="dsList" columnid="DS_VENDOR"/>
      <BindItem id="item3" compid="divData.form.ctxtDS_WRITER" propid="value" datasetid="dsList" columnid="DS_WRITER"/>
      <BindItem id="item4" compid="divData.form.ctxtDS_GONGJONG" propid="value" datasetid="dsList" columnid="DS_GONGJONG"/>
      <BindItem id="item5" compid="divSearch.form.ctxtNO_SEQ" propid="value" datasetid="dsSearch" columnid="NO_SEQ"/>
      <BindItem id="item6" compid="divData.form.ctxtDS_WORKAREA" propid="value" datasetid="dsList" columnid="DS_WORKAREA"/>
      <BindItem id="item7" compid="divData.form.ctclDT_WORK_FR" propid="value" datasetid="dsList" columnid="DT_WORKTIME_FR"/>
      <BindItem id="item8" compid="divData.form.ctclDT_WORK_TO" propid="value" datasetid="dsList" columnid="DT_WORKTIME_TO"/>
      <BindItem id="item9" compid="divData.form.ctxtHM_WORK_FR" propid="value" datasetid="dsList" columnid="DT_WORKTIMEHHMM_FR"/>
      <BindItem id="item10" compid="divData.form.ctxtHM_WORK_TO" propid="value" datasetid="dsList" columnid="DT_WORKTIMEHHMM_TO"/>
      <BindItem id="item11" compid="divData.form.ctxtNO_WORKER" propid="value" datasetid="dsList" columnid="NO_WORKER"/>
      <BindItem id="item12" compid="divData.form.ctxtDS_MANAGER_TEL" propid="value" datasetid="dsList" columnid="DS_MANAGER_TEL"/>
      <BindItem id="item13" compid="divData.form.ctxtDS_APPROVALGONGSA" propid="value" datasetid="dsList" columnid="DS_APPROVALGONGSA"/>
      <BindItem id="item14" compid="divData.form.ctxtDS_APPROVALSAFER" propid="value" datasetid="dsList" columnid="DS_APPROVALSAFER"/>
      <BindItem id="item15" compid="divData.form.staBgRISK_LABEL2" propid="value" datasetid="dsList" columnid="TY_WORK"/>
      <BindItem id="item16" compid="divData.form.staBgRISK_LABEL2" propid="text" datasetid="dsList" columnid="DS_WORK"/>
      <BindItem id="item17" compid="divData.form.ctxtDS_WORKCONTENT" propid="value" datasetid="dsList" columnid="DS_WORKCONTENT"/>
      <BindItem id="item18" compid="divData.form.ctxtDS_WORKSAFE" propid="value" datasetid="dsList" columnid="DS_WORKSAFE"/>
    </Bind>
  </Form>
</FDL>
